#!/usr/bin/env python

#This is the file to make my first  shake
#a proof of concept with only protein and water
#testing github

import rospy
import time
from std_msgs.msg import String
from shakestation.msg import JointPose
from servosix import ServoSix

def build_shake():
	#create the ROS node for the application	
	rospy.init_node('shakemaker')

	#move the manipulator to the initial position
	pub = rospy.Publisher('/robotis/base/joint_pose_msg',JointPose, queue_size=1)
	time.sleep(2) #time for publisher to register with master
	msg0 = JointPose()
	msg0.name = ["joint1", "joint2", "joint3", "joint4", "joint5", "joint6"]
	msg0.value = [0.0, -0.6579891280018623, 0.05009094953223726, 0.0, 0.6085963101704226, 0.0]
	pub.publish(msg0)
	print("moved to start position 1")

	#move the manipulator to the initial cup position
	msg1 = JointPose()
	msg1.name = ["joint1", "joint2", "joint3", "joint4", "joint5", "joint6"]
	msg1.value = [-0.7819075048934596, 0.9948376736367678, 0.43493604959698695, -0.2617993877991494, -1.53588974175501, -0.00890117918517108]
	time.sleep(4) 
	pub.publish(msg1)
	print("moved to approach cup postion 2")

	#move the manipulator to the grasp cup position
	msg2 = JointPose()
	msg2.name = ["joint1", "joint2", "joint3", "joint4", "joint5", "joint6"]
	msg2.value = [-0.7819075048934596, 0.9948376736367678, 0.43493604959698695, 0.0, -1.53588974175501, -0.00890117918517108]
	time.sleep(4) 
	pub.publish(msg2)
	print("moved to grasp cup postion 3")

	#grasp cup
	ss= ServoSix()
	t_end = time.time() + 15
	while time.time() < t_end:
		ss.set_servo(1,30)
	time.sleep(2) 
	
	print("grasped cup")

	#move the manipulator to the initial cup position
	msg3 = JointPose()
	msg3.name = ["joint1", "joint2", "joint3", "joint4", "joint5", "joint6"]
	msg3.value = [-0.7819075048934596, 0.9948376736367678, 0.43493604959698695, -0.2617993877991494, -1.53588974175501, -0.00890117918517108]
	time.sleep(4) 
	pub.publish(msg3)
	print("moved to approach cup postion 4")

	#move the manipulator to the initial position
	msg4 = JointPose()
	msg4.name = ["joint1", "joint2", "joint3", "joint4", "joint5", "joint6"]
	msg4.value = [0.0, -0.6579891280018623, 0.05009094953223726, 0.0, 0.6085963101704226, 0.0]
	time.sleep(4) 
	pub.publish(msg4)
	print("return to start position 5")
	
if __name__=='__main__':
	try:
		build_shake()
	except rospy.ROSInterruptException:
		pass
